\subsubsection{Extended Fx Forward Swap}

Extended Fx Forward Swap are represented as scripted trades, refer to appendix A for an introduction. Listing \ref{lst:extendedfxforwardswap} shows the structure of an example.

\begin{listing}[H]
\begin{minted}[fontsize=\footnotesize]{xml}
<Trade id="SCRIPTED_ExtendedFxForwardSwap">
  <TradeType>ScriptedTrade</TradeType>
  <Envelope>
    <CounterParty>CPTY_A</CounterParty>
    <NettingSetId>CPTY_A</NettingSetId>
    <AdditionalFields/>
  </Envelope>
  <ScriptedTradeData>
    <ScriptName>ExtendedFxForwardSwap</ScriptName>
			<Data>
				<Event>
					<Name>ObservationDates</Name>
					<ScheduleData>
						<Dates>
							<Calendar/>
							<Tenor/>
							<Dates>
								<Date>2019-09-30</Date>
								<Date>2019-10-31</Date>
								<Date>2019-11-28</Date>
								<Date>2019-12-31</Date>
								<Date>2020-01-30</Date>
								<Date>2020-02-27</Date>
							</Dates>
						</Dates>
					</ScheduleData>
				</Event>
				<Event>
					<Name>ObservationSettlementDates</Name>
					<ScheduleData>
						<Dates>
							<Calendar/>
							<Tenor/>
							<Dates>
								<Date>2019-10-02</Date>
								<Date>2019-11-02</Date>
								<Date>2019-12-30</Date>
								<Date>2020-01-02</Date>
								<Date>2020-02-03</Date>
								<Date>2020-03-30</Date>
							</Dates>
						</Dates>
					</ScheduleData>
				</Event>
				<Event>
					<Name>ExtensionDecisionDate</Name>
					<Value>2020-02-25</Value>
				</Event>
				<Event>
					<Name>ConditionalObservationDates</Name>
					<ScheduleData>
						<Dates>
							<Calendar/>
							<Tenor/>
							<Dates>
								<Date>2020-03-31</Date>
								<Date>2020-04-30</Date>
								<Date>2020-05-29</Date>
								<Date>2020-06-30</Date>
								<Date>2020-07-31</Date>
								<Date>2020-08-31</Date>
							</Dates>
						</Dates>
					</ScheduleData>
				</Event>
				<Event>
					<Name>ConditionalSettlementDates</Name>
					<ScheduleData>
						<Dates>
							<Calendar/>
							<Tenor/>
							<Dates>
								<Date>2020-03-31</Date>
								<Date>2020-04-30</Date>
								<Date>2020-05-29</Date>
								<Date>2020-06-30</Date>
								<Date>2020-07-31</Date>
								<Date>2020-08-31</Date>
							</Dates>
						</Dates>
					</ScheduleData>
				</Event>
				<Number>
					<Name>Notional</Name>
					<Value>1000000</Value>
				</Number>
				<Number>
					<Name>Strike</Name>
					<Value>1.19</Value>
				</Number>
				<Number>
					<Name>ExtensionTrigger</Name>
					<Value>1.19</Value>
				</Number>
				<Index>
					<Name>Underlying</Name>
					<Value>FX-ECB-EUR-USD</Value>
				</Index>
				<Currency>
					<Name>Currency</Name>
					<Value>USD</Value>
				</Currency>
				<Currency>
					<Name>PayCurrency</Name>
					<Value>EUR</Value>
				</Currency>
			</Data>
  </ScriptedTradeData>
</Trade>
\end{minted}
\caption{Extended Fx Forward Swap Representation}
\label{lst:extendedfxforwardswap}
\end{listing}

The meanings and allowable values of the elements in the \verb+Extended Fx Forward Swap+  representation follow below.

\begin{itemize}
\item Strike: the strike of the option, input as a percentage (of the value of Index Initial)
\item Underlying: the underlying index
\item Notional: the notional amount of the option
\item PayCurrency: the currency of the underlying swap notional
\item ExtensionDecisionDate: the date on which the Extension Condition is decided on
\item ExtensionTrigger: the value of the index below which a Trigger Event occurs on any of the Strike Observation Dates
\item SettlementDate: the settlement date of the option payoff
\item Currency: the settlement currency
\item ObservationDates: the dates on which the underlying index value is observed, define the exchange of notionals
\item ObservationSettlementDates: observation settlement dates
\item ConditionalObservationDates: the dates on which the underlying index value is observed, define the exchange of notionals
\item ConditionalSettlementDates: conditional observation settlement dates
\end{itemize}

The script `ExtendedFxForwardSwap' referenced in the trade above is shown in Listing \ref{lst:extendedfxforwardswap_script}.

\begin{listing}[H]
\begin{minted}[fontsize=\footnotesize]{xml}

REQUIRE {Notional >= 0} AND {Strike >= 0};
REQUIRE {SIZE(ConditionalObservationDates) == SIZE(ConditionalSettlementDates)};
NUMBER d, FOR_AMOUNT, Fix;
            
FOR_AMOUNT = Notional/Strike;
FOR d IN (1, SIZE(ObservationDates), 1) DO
  Fix = Underlying(ObservationDates[d]);
  Value = Value + PAY(FOR_AMOUNT-Notional/Fix, ObservationDates[d], ObservationSettlementDates[d], PayCurrency);
END;
            
IF Underlying(ExtensionDecisionDate)>ExtensionTrigger THEN
  FOR d IN (1, SIZE(ConditionalObservationDates), 1) DO
    Fix = Underlying(ConditionalObservationDates[d]);
    Value = Value + PAY(FOR_AMOUNT-Notional/Fix, ConditionalObservationDates[d], ConditionalSettlementDates[d], PayCurrency);
  END;
END;
\end{minted}
\caption{ExtendedFxForwardSwap Script}
\label{lst:extendedfxforwardswap_script}
\end{listing}

