%========================================================
\section{Trade Data}\label{sec:portfolio_data}
%========================================================

The trades that make up the portfolio are specified in an XML file where the portfolio data is specified in a hierarchy
of nodes and sub-nodes.  The nodes containing individual trade data are referred to as elements or XML elements. These
are generally the lowest level nodes.

\vspace{1em}

The top level portfolio node is delimited by an opening {\tt <Portfolio>} and a closing {\tt </Portfolio>} tag. Within
the portfolio node, each trade is defined by a starting {\tt <Trade id="[Tradeid]">} and a closing {\tt </Trade>} tag.
Further, the trade type is set by the TradeType XML element. Each trade has an Envelope node that includes the same XML
elements for all trade types (Id, Type, Counterparty, Rating, NettingSetId) plus the Additional fields node, and after
that, a node containing trade specific data.

\vspace{1em}
An example of a {\tt portfolio.xml} file with one Swap trade including the full envelope node is shown in Listing \ref{lst:portfolio}.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
<Portfolio>
  <Trade id="Swap#1">
    <TradeType> Swap </TradeType>
    <Envelope>
      <CounterParty> Counterparty#1 </CounterParty>
      <NettingSetId> NettingSet#2 </NettingSetId>
      <AdditionalFields>
        <Sector> SectorA </Sector>
        <Book> BookB </Book>
        <Rating> A1 </Rating>
      </AdditionalFields>
    </Envelope>
    <SwapData>
        ...
        [Trade specific data for a Swap]
        ...
    </SwapData>
  </Trade>
</Portfolio>
\end{minted}
\caption{Portfolio}
\label{lst:portfolio}
\end{listing}

A description of all portfolio data, i.e. of each node and XML element in the portfolio file, with examples and
allowable values follows below. There are two XML elements directly under the top level {\tt Portfolio} node:

\begin{itemize}
\item {\tt Trade id}: The first element of each trade is the {\tt Trade id} and it is used to identify trades within a
  portfolio. Trade ids should be unique within a portfolio.  The {\tt Trade id} element is entered twice in the
  instrument file, firstly with an attribute to the XML element {\tt <Trade>}, such as {\tt <Trade id="ExampleTrade">}
  in the beginning closed by {\tt </Trade>} at the end of the trade data, and secondly with a {\tt Id} element in the
  envelope node.  Both Trade id entries should be identical.

Allowable values:  Any alphanumeric string. The underscore (\_) sign may be used as well. 


\item {\tt TradeType}: %The Trade type is set with the {\tt TradeType} element, as well as with the {\tt Type} element in  the envelope. The two Trade type entries should be identical. 
ORE currently supports 11 trade types.

%Allowable values:  \emph{Swap, CapFloor, Swaption, FxForward, FxOption, Bond, CreditDefaultSwap}
Allowable values: \emph{ForwardRateAgreement, Swap, CapFloor, Swaption, FxForward, FxSwap, FxOption,
EquityForward, EquityOption, CreditDefaultSwap, Bond}

\end{itemize}

%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
\subsection{Envelope}\label{ss:envelope}
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
The envelope node contains basic identifying details of a trade ({\tt
  Id}, {\tt Type}, {\tt Counterparty}, {\tt Rating}, {\tt
  NettingSetId}), plus an {\tt AdditionalFields} node where custom
elements can be added for informational purposes such as {\tt Book} or
{\tt Sector}. Beside the custom elements within the {\tt
  AdditionalFields} node, the envelope contains the same elements for
all Trade types.  The {\tt Id}, {\tt Type}, {\tt Counterparty} and
{\tt NettingSetId} elements must have non-blank entries for ORE to
run, whereas ORE will run without a {\tt Rating} element but fail to
produce a CVA. \\

The meanings and allowable values of the various elements in the \lstinline!Envelope!  node follow below.

\begin{itemize}
\item {\tt Id}: The {\tt Id} element in the envelope is used to identify trades within a portfolio. It should be set to
  identical values as the {\tt Trade id=" "} element.

  Allowable values: Any alphanumeric string. The underscore (\_) sign may be used as well.

%\item {\tt Type}: The Trade Type is in addition to being set in the {\tt ClassName} element, also set by the {\tt Type}
%  element in the envelope. Both elements should have the same entry.
%
%Allowable values: \emph{ForwardRateAgreement, Swap, CapFloor, Swaption, FxForward, FxSwap, FxOption,
%EquityForward, EquityOption, CreditDefaultSwap, Bond}

\item {\tt Counterparty}: Specifies the name of the counterparty of the trade.  It is used to show exposure analytics by
  counterparty.

Allowable values: Any alphanumeric string. Underscores (\_) and blank spaces may be used as well. 

\item {\tt Rating} [Optional]: The {\tt Rating} element specifies the default curve that will be used in the CVA
  calculations.  No CVA will be calculated if omitted or left blank.

Allowable values: An alphanumeric string that matches default curve names in the market configuration file.  

\item {\tt NettingSetId} [Optional]: The {\tt NettingSetId} element specifies the identifier for a netting set. If a
  \lstinline!NettingSetId! is specified, the trade is eligible for close-out netting under the terms of an associated
  ISDA agreement. The specified {\tt NettingSetId} must be defined within the netting set definitions file
  (see section \ref{sec:nettingsetinput}). If left blank or omitted the trade will not belong to any netting set, and thus not be
  eligible for netting.

Allowable values: Any alphanumeric string. Underscores (\_) and blank spaces may be used as well. 

% -- specified netting --Negative transaction values offset exposures from positive transaction values within specified
% netting groups. Total netting
% group %-- exposures and exposures from transactions not belonging to a netting group are then combined without offsetting.

\item \lstinline!AdditionalFields! [Optional]: The AdditionalFields node allows the insertion of additional trade
  information using custom XML elements.  For example, elements such as Sector, Desk or Folder can be used. The elements
  within the \lstinline!AdditionalFields! node are used for informational purposes only, and do not affect pricing or
  exposure calculations and analytics.

Allowable values: Any custom element.

\end{itemize}

%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
\subsection{Trade Specific Data}
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

After the envelope node, trade-specific data for each trade type supported by
ORE is included. 
Each trade type has its own trade data container which is defined by an XML node containing a trade-specific
configuration of individual XML tags - called elements - and trade components. The trade components are defined by XML
sub-nodes that can be used within multiple trade data containers, i.e.  by multiple trade types.

\vspace{1em}

Details of  trade-specific data for all trade types follow below.

\subsubsection{Swap}

The \lstinline!SwapData! node is the trade data container for the Swap trade type. A Swap must have at least one leg,
and can have an unlimited number of legs. Each leg is represented by a \lstinline!LegData! trade component sub-node,
described in section \ref{ss:leg_data}. An example structure of a two-legged \lstinline!SwapData!
node is shown in Listing \ref{lst:swap_data}.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
<SwapData>
  <LegData>
    ...
  </LegData>
  <LegData>
    ...
  </LegData>
</SwapData>
\end{minted}
\caption{Swap data}
\label{lst:swap_data}
\end{listing}

\subsubsection{Cap/Floor}

The \lstinline!CapFloorData! node is the trade data container for trade type CapFloors.  It's a cap, floor or collar
(i.e. a portfolio of a long cap and a short floor for a long position in the collar) on a series of Ibor rates. The
\lstinline!CapFloorData! node contains a \lstinline!LongShort! sub-node which indicates whether the cap (floor, collar)
is long or short, and a \lstinline!LegData!  sub-node where the LegType element must be set to \emph{Floating}, plus
elements for the Cap and Floor rates. An example structure with Cap rates is shown in in Listing
\ref{lst:capfloor_data}. A \lstinline!CapFloorData! node must have either \lstinline!Caps! or \lstinline!Floors!
elements, or both.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
  <CapFloorData>
  <LongShort>Long</LongShort>
  <LegData>
    <Payer>false</Payer>
    <LegType>Floating</LegType>
     ...
  </LegData>
  <Caps>
    <Rate>0.05</Rate>
  </Caps>
</CapFloorData>
\end{minted}
\caption{Cap/Floor data}
\label{lst:capfloor_data}
\end{listing}

The meanings and allowable values of the elements in the \lstinline!CapFloorData!  node follow below.

\begin{itemize}

\item LongShort: This node defines the position in the cap (floor, collar) and can take values \lstinline!Long! or
  \lstinline!Short!

\item LegData: This is a trade component sub-node outlined in section \ref{ss:leg_data}. Exactly
  one \lstinline!LegData! node is allowed and the LegType element must be set to \emph{floating}.

\item Caps: This node has child elements of type \lstinline!Rate!
  capping the floating leg. The first rate value corresponds to the
  first coupon, the second rate value corresponds to the second
  coupon, etc. If the number of coupons exceeds the number of rate
  values, the rate will be kept flat at the value of last entered rate
  for the remaining coupons. For a fixed cap rate over all coupons,
  one single rate value is sufficient. The number of entered rate
  values cannot exceed the number of coupons. 

  Allowable values for each \lstinline!Rate! element: Any real number. The rate is expressed in decimal form, eg 0.05 is
  a rate of 5\%

\item Floors: This node has child elements of type
  \lstinline!Rate! flooring the floating leg.  The first rate value
  corresponds to the first coupon, the second rate value corresponds
  to the second coupon, etc. If the number of coupons exceeds the
  number of rate values, the rate will be kept flat at the value of
  last entered rate for the remaining coupons. For a fixed floor rate
  over all coupons, one single rate value is sufficient. The number of
  entered rate values cannot exceed the number of coupons.

  Allowable values for each \lstinline!Rate! element: Any real number. The rate is expressed in decimal form, eg 0.05 is
  a rate of 5\%

\end{itemize}

\subsubsection{Swaption}

The \lstinline!SwaptionData!  node is the trade data container for the Swaption trade type. The \lstinline!SwaptionData!
node has one and exactly one \lstinline!OptionData! trade component sub-node, and at least one \lstinline!LegData! trade
component sub-node.  These trade components are outlined in section \ref{ss:option_data} and section
\ref{ss:leg_data}.\\

Supported swaption exercise styles are European and Bermudan. European swaptions can have unlimited number of legs, with
each leg represented by a \lstinline!LegData! sub-node. Bermudan swaptions must have two legs, i.e. two
\lstinline!LegData! sub-nodes. See Table \ref{tab:bermudan_requirements} for further details on requirements for
Bermudan swaptions. Cross currency swaptions are not supported for either exercise style, i.e. the Currency element must
have the same value for all \lstinline!LegData! sub-nodes of a swaption.\\

The structure of an example \lstinline!SwaptionData!  node of a two-legged European swaption is shown in Listing
\ref{lst:swaption_data}.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
<SwaptionData>
    <OptionData>
        <Style>European</Style>
        ...
    </OptionData>
    <LegData>
        <Currency>GBP</Currency>
        ...
    </LegData>
    <LegData>
        <Currency>GBP</Currency>
        ...
    </LegData>
</SwaptionData>
\end{minted}
\caption{Swaption data}
\label{lst:swaption_data}
\end{listing}

\begin{table}[H]
\centering
\begin{tabu} to 0.9\linewidth {| X[-1.5,l,m] | X[-5,l,m] |}
    \hline
        & \bfseries{A Bermudan Swaption requires:} \\  \hline
    \lstinline!OptionData! & One \lstinline!OptionData! sub-node  \\  \hline
   \lstinline!Style! &  \emph{Bermudan}\\ \hline
    \lstinline!ExerciseDates! & At least two \lstinline!ExerciseDate! child elements.\\ \hline
    \lstinline!LegData! &  Two \lstinline!LegData! sub-nodes \\ \hline
    \lstinline!LegType! & \emph{Fixed} on one node and \emph{Floating} on the other.\\ \hline    
    \lstinline!Currency! & The same currency for both nodes.\\ \hline 
    \lstinline!Notionals! & No accretion or amortisation, just a constant notional. Exactly one \lstinline!Notional! child element for each node.\\ \hline
    \lstinline!Rates! & A constant rate. The fixed rate node should have exactly one \lstinline!Rate! child element.\\ \hline
    \lstinline!Spreads! &  A constant spread. The floating rate node should have exactly one \lstinline!Spread! child element.\\ \hline
%    \bfseries{ScheduleData} &   \\ \hline   
%    \lstinline!IsRuleBased! & Must be \emph{true} for both nodes. TBC: Fixed by Henning?\\ \hline      
  \end{tabu}
  \caption{Requirements for Bermudan Swaptions}
  \label{tab:bermudan_requirements}
\end{table}

\subsubsection{FX Forward}

The \lstinline!FXForwardData!  node is the trade data container for the FX Forward trade type.  The structure -
including example values - of the \lstinline!FXForwardData!  node is shown in Listing \ref{lst:fxforward_data}. It
contains no sub-nodes.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
        <FxForwardData>
            <ValueDate>2023-04-09</ValueDate>
            <BoughtCurrency>EUR</BoughtCurrency>
            <BoughtAmount>1000000</BoughtAmount>
            <SoldCurrency>USD</SoldCurrency>
            <SoldAmount>1500000</SoldAmount>
        </FxForwardData>
\end{minted}
\caption{FX Forward data}
\label{lst:fxforward_data}
\end{listing}

The meanings and allowable values of the various elements in the \lstinline!FXForwardData!  node follow below.  All elements are required.

\begin{itemize}
\item ValueDate: The value date of the FX Forward. \\ Allowable values:  See \lstinline!Date! in Table \ref{tab:allow_stand_data}.
\item BoughtCurrency: The currency to be bought on value date.  \\ Allowable values:  See \lstinline!Currency! in Table \ref{tab:allow_stand_data}.
\item BoughtAmount: The amount to be sold on value date.  \\ Allowable values:  Any positive real number.
\item SoldCurrency: The currency to be sold on value date.  \\ Allowable values:  See \lstinline!Currency! in Table \ref{tab:allow_stand_data}.
\item SoldAmount: The amount to be sold on value date.  \\ Allowable values:  Any positive real number.

\end{itemize}


\subsubsection{FX Option}

The \lstinline!FXOptionData!  node is the trade data container for the FX Option trade type.  Vanilla FX options are
supported, the exercise style must be \emph{European}. The strike rate of an FX option is: SoldAmount / BoughtAmount. The
\lstinline!FXOptionData!  node includes one and only one \lstinline!OptionData! trade component sub-node plus elements
specific to the FX Option. The structure of an example \lstinline!FXOptionData! node for a FX Option is shown in Listing
\ref{lst:fxoption_data}.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
        <FxOptionData>
            <OptionData>
             ...
            </OptionData>
            <BoughtCurrency>EUR</BoughtCurrency>
            <BoughtAmount>1000000</BoughtAmount>
            <SoldCurrency>USD</SoldCurrency>
            <SoldAmount>1350000</SoldAmount>
        </FxOptionData>
\end{minted}
\caption{FX Option data}
\label{lst:fxoption_data}
\end{listing}

The meanings and allowable values of the elements in the \lstinline!FXOptionData!  node follow below.

\begin{itemize}
\item OptionData: This is a trade component sub-node outlined in section \ref{ss:option_data}. Note that the
  FX option type allows for \emph{European} option style only.

\item BoughtCurrency: The bought currency of the FX option.  

Allowable values:  See Currency in Table \ref{tab:allow_stand_data}.

\item BoughtAmount: The amount in the BoughtCurrency.  

Allowable values:  Any positive real number.

\item SoldCurrency: The sold currency of the FX option.  

Allowable values:  See Currency in Table \ref{tab:allow_stand_data}.

\item SoldAmount: The amount in the SoldCurrency.  

Allowable values:  Any positive real number.

\end{itemize}

\subsubsection{Equity Option}

The \lstinline!EquityOptionData!  node is the trade data container for the equity option trade type.  Vanilla equity 
options are supported, the exercise style must be \emph{European}. The \lstinline!EquityOptionData!  node includes one and 
only one \lstinline!OptionData! trade component sub-node plus elements specific to the equity option. The structure of 
an example \lstinline!EquityOptionData! node for an equity option is shown in Listing
\ref{lst:eqoption_data}.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
<EquityOptionData>
    <OptionData>
      ...
    </OptionData>
    <Name>SP5</Name>
    <Currency>USD</Currency>
    <Strike>2147.56</Strike>
    <Quantity>17000</Quantity>
</EquityOptionData>
\end{minted}
\caption{FX Option data}
\label{lst:eqoption_data}
\end{listing}

The meanings and allowable values of the elements in the \lstinline!EquityOptionData!  node follow below.

\begin{itemize}
	\item OptionData: This is a trade component sub-node outlined in section \ref{ss:option_data} Option Data. Note 
	that the FX option type allows for \emph{European} option style only.	
	\item Name: The name of the underlying equity. \\
	Allowable values:  Any string (provided it is the ID of an equity in the market configuration).
	\item Currency: The bought currency of the equity option. \\
	Allowable values:  See Currency in Table \ref{tab:allow_stand_data}.	
	\item Strike: The option strike price.\\
	Allowable values:  Any positive real number.	
	\item Quantity: The number of units of the underlying covered by the transaction. \\
	Allowable values:  Any positive real number.
\end{itemize}

\subsubsection{Equity Forward}

The \lstinline!EquityForwardData!  node is the trade data container for the equity forward trade type.  Vanilla equity 
forwards are supported. The structure of an example \lstinline!EquityForwardData! node for an equity option is shown in 
Listing \ref{lst:eqfwd_data}.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
<EquityForwardData>
  <LongShort>Long</LongShort>
  <Maturity>2018-06-30</Maturity>
  <Name>SP5</Name>
  <Currency>USD</Currency>
  <Strike>2147.56</Strike>
  <Quantity>17000</Quantity>
</EquityForwardData>
\end{minted}
\caption{Equity Forward data}
\label{lst:eqfwd_data}
\end{listing}

The meanings and allowable values of the elements in the \lstinline!EquityForwardData!  node follow below.

\begin{itemize}
	\item LongShort: Defines whether the trade is long or short the underlying equity
	Allowable values: Long, Short.
	\item Maturity: The maturity date of the forward contract
	Allowable values: Any date string.
	\item Name: The name of the underlying equity 	
	Allowable values:  Any string (provided it is the ID of an equity in the market configuration).
	\item Currency: The bought currency of the equity option.  	
	Allowable values:  See Currency in Table \ref{tab:allow_stand_data}.	
	\item Strike: The option strike price.  
	Allowable values:  Any positive real number.	
	\item Quantity: The number of units of the underlying covered by the transaction  
	Allowable values:  Any positive real number.
\end{itemize}

\subsubsection{CPI Swap}

A CPI swap is set up as a swap, with one leg of type {\tt CPI}. Listing \ref{lst:cpiswap} shows an example. The
CPI leg contains an additional {\tt CPILegData} block. See \ref{ss:cpilegdata} for details on the CPI leg specification.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
    <SwapData>
      <LegData>
        <LegType>Floating</LegType>
        <Payer>true</Payer>
        ...
      </LegData>
      <LegData>
        <LegType>CPI</LegType>
        <Payer>false</Payer>
        ...
        <CPILegData>
        ...
        </CPILegData>
      </LegData>
    </SwapData>
\end{minted}
\caption{CPI Swap Data}
\label{lst:cpiswap}
\end{listing}

\subsubsection{Year on Year Inflation Swap}

A Year on Year inflation swap is set up as a swap, with one leg of type {\tt YY}. Listing \ref{lst:yyswap} shows an
example. The YY leg contains an additional {\tt YYLegData} block. See \ref{ss:yylegdata} for details on the YY leg
specification.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
    <SwapData>
      <LegData>
        <LegType>Floating</LegType>
        <Payer>true</Payer>
        ...
      </LegData>
      <LegData>
        <LegType>YY</LegType>
        <Payer>false</Payer>
        ...
        <YYLegData>
        ...
        </YYLegData>
      </LegData>
    </SwapData>
\end{minted}
\caption{Year on Year Swap Data}
\label{lst:yyswap}
\end{listing}

\subsubsection{Bond}

A vanilla Bond is set up using a {\tt BondData} block as shown in listing \ref{lst:bonddata}. The bond specific elements
are

\begin{itemize}
\item IssuerId: A unique identifier for the issuer of the bond
\item CreditCurveId: The entity defining the default curve used for pricing, via the default curves block in {\tt
    todaysmarket.xml}
% \item LGD (optional): If given, this LGD is used for pricing, overriding the default LGD of the default curve
\item SecurityId: A unique identifier for the security, this defines the security specific spread to be used for
  pricing, see section \ref{sssec:securityspreads}
\item ReferenceCurveId: The benchmark curve to be used for pricing, this must match a name of a curve in the yield
  curves block in {\tt todaysmarket.xml}
\item SettlementDays: The settlement delay applicable to the security
\item Calendar: The calendar associated to the settlement lag
\item IssueDate: The issue date of the security.
\end{itemize}

A LegData block then defines the cashflow structure of the bond, this can be of type fixed, floating etc.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
    <BondData>
        <IssuerId>CPTY_C</IssuerId>
        <CreditCurveId>CPTY_C</CreditCurveId>
        <SecurityId>SECURITY_1</SecurityId>
        <ReferenceCurveId>EUR-EURIBOR-6M</ReferenceCurveId>
        <SettlementDays>2</SettlementDays>
        <Calendar>TARGET</Calendar>
        <IssueDate>20160203</IssueDate>
        <LegData>
            <LegType>Fixed</LegType>
            <Payer>false</Payer>
            ...
        </LegData>
    </BondData>
\end{minted}
\caption{Bond Data}
\label{lst:bonddata}
\end{listing}

The bond pricing requires a recovery rate that can be specified in ORE per SecurityId, see sections \ref{sssec:securityrecoveryrates} and \ref{md:sec_rec_rates}. 

\subsubsection{Credit Default Swap}

A credit default swap is set up using a {\tt CreditDefaultSwapData} block as shown in listing \ref{lst:cdsdata}. The CDS specific elements
are

\begin{itemize}
\item IssuerId: A unique identifier for the issuer of the bond
\item CreditCurveId: The entity defining the default curve used for pricing, via the default curves block in {\tt
    todaysmarket.xml}
\item SettleAtAccrual: Whether or not the accrued coupon is due in the event of a default.
\item PaysAtDefaultTime: If set to true, any payments triggered by a default event are due at default time. If set to false, they are due at the end of the accrual period.
\item ProtectionStart: The first date where a default event will trigger the contract.
\item UpfrontDate: Settlement date for the upfront payment.
\item UpfrontFee: The upfront payment, expressed as a rate, to be multiplied by notional amount.
\end{itemize}

A LegData block then defines the cashflow structure of the credit default swap, this must be be of type fixed.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
    <CreditDefaultSwapData>
      <IssuerId>CPTY_A</IssuerId>
      <CreditCurveId>BANK</CreditCurveId>
      <Qualifier>SECURITY_1</Qualifier>
      <SettlesAccrual>Y</SettlesAccrual>
      <PaysAtDefaultTime>Y</PaysAtDefaultTime>
      <ProtectionStart>20160206</ProtectionStart>
      <UpfrontDate>20160208</UpfrontDate>
      <UpfrontFee>0.0</UpfrontFee>
      <LegData>
            <LegType>Fixed</LegType>
            <Payer>false</Payer>
            ...
        </LegData>
    </CreditDefaultSwapData>
\end{minted}
\caption{CreditDefaultSwap Data}
\label{lst:cdsdata}
\end{listing}

\subsubsection{Forward Rate Agreement}

A forward rate agreement is set up using a {\tt ForwardRateAgreementData} block as shown in listing \ref{lst:ForwardRateAgreementdata}. The forward rate agreement specific elements
are

\begin{itemize}
\item StartDate: A FRA expires/settles on the startDate . \\ Allowable values:  See \lstinline!Date! in Table \ref{tab:allow_stand_data}.\item CreditCurveId: The entity defining the default curve used for pricing, via the default curves block in {\tt
    todaysmarket.xml}
\item EndDate: EndDate is the date when the forward loan or deposit ends. It follows that (EndDate - StartDate) is the tenor/term of the underlying loan or deposit
\item Currency: The currency of the FRA notional.  	
	Allowable values:  See Currency in Table \ref{tab:allow_stand_data}.	
\item Index: The name of the interest rate index the FRA is benchmarked against
\item LongShort: Specifies whether the option position is long  or
  short.
\item Strike: The agreed forward interest rate
\item Notional: No accretion or amortisation, just a constant notional.
\end{itemize}

A LegData block then defines the cashflow structure of the bond, this can be of type fixed, floating etc.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
    <ForwardRateAgreementData>
        <StartDate>20161028</StartDate>
        <EndDate>20351028</EndDate>
        <Currency>EUR</Currency>
        <Index>EUR-EURIBOR-6M</Index>
        <LongShort>Long</LongShort>
        <Strike>0.00001</Strike>
        <Notional>1000000000</Notional>
    </ForwardRateAgreementData>
\end{minted}
\caption{Forward Rate Agreement Data}
\label{lst:ForwardRateAgreementdata}
\end{listing}

The bond pricing requires a recovery rate that can be specified in ORE per SecurityId, see sections \ref{sssec:securityrecoveryrates} and \ref{md:sec_rec_rates}. 

%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
\subsection{Trade Components}
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Trade components are XML sub-nodes used within the trade data containers to define sets of trade data that more than one
trade type can have in common, such as a leg or a schedule. A trade data container can include multiple trade components
such as a swap with multiple legs, and a trade component can itself contain further trade components in a nested way.

\vspace{1em}

An example of a \lstinline!SwapData! trade data container, including two \lstinline!LegData! trade components which in
turn include further trade components such as \lstinline!FixedLegData!, \lstinline!ScheduleData! and
\lstinline!FloatingLegData! is shown in Listing \ref{lst:trade_component}.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
        <SwapData>
            <LegData>
                <Payer>true</Payer>
                <LegType>Fixed</LegType>
                <Currency>EUR</Currency>
                <PaymentConvention>Following</PaymentConvention>
                <DayCounter>30/360</DayCounter>
                <Notionals>
                    <Notional>1000000</Notional>
                </Notionals>
                <ScheduleData>
                ...
                </ScheduleData>
                <FixedLegData>
                    <Rates>
                        <Rate>0.035</Rate>
                    </Rates>
                </FixedLegData>
            </LegData>
            <LegData>
                ...
                <ScheduleData>
                    ...
                </ScheduleData>
                <FloatingLegData>
                    ...
                </FloatingLegData>
            </LegData>
        </SwapData>
\end{minted}
\caption{Trade Components Example}
\label{lst:trade_component}
\end{listing}

Descriptions of all trade components supported in ORE follow below:

\subsubsection{Option Data}
\label{ss:option_data} 
This trade component node is used within the \lstinline!SwaptionData! and \lstinline!FXOptionData! trade data
containers. It contains the \lstinline!ExerciseDates! sub-node which includes \lstinline!ExerciseDate! child
elements. An example structure of the \lstinline!OptionData! trade component node is shown in Listing
\ref{lst:option_data}.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
            <OptionData>
                <LongShort>Long</LongShort>
                <OptionType>Call</OptionType>
                <Style>Bermudan</Style>
                <Settlement>Cash</Settlement> 
                <PayOffAtExpiry>true</PayOffAtExpiry>
                <ExerciseDates>
                    <ExerciseDate>2016-04-20</ExerciseDate>
                    <ExerciseDate>2017-04-20</ExerciseDate>
                </ExerciseDates>
            </OptionData>
\end{minted}
\caption{Option data}
\label{lst:option_data}
\end{listing}

The meanings and allowable values of the elements in the \lstinline!OptionData! node follow below.

\begin{itemize}
\item LongShort: Specifies whether the option position is long  or
  short.  

Allowable values: \emph{Long, LONG, long, L} or \emph{Short, SHORT,
  short, S}

\item OptionType: Specifies whether it is a call or a put option. 

Allowable values: \emph{Call} or \emph{Put} 

\item Style: The exercise style of the option. 

  Allowable values: \emph{European} or \emph{American} or \emph{Bermudan}. Note that trade type Swaption can have style
  \emph{European} or \emph{Bermudan}, but not \emph{American}. The FX Option trade type can have style \emph{European}
  or \emph{American}, but not \emph{Bermudan}.

\item Settlement: Derlivery type. 

Allowable values: \emph{Cash} or \emph{Physical} 

\item PayOffAtExpiry [Optional]: Relevant for options with early
  exercise, i.e. the exercise occurs before expiry; \emph{true}
  indicates payoff at expiry, whereas \emph{false}  indicates payoff
  at exercise. Defaults to \emph{false}  if left blank or omitted. 

Allowable values: \emph{true}, \emph{false}
%TBC: Do not see payoffatexpiry used in either fxoption or swaption build() functions, to be logged as a bug.       

\item ExerciseDates: This node contains child elements of type
  \lstinline!ExerciseDate!.  Options of style \emph{European} or
  \emph{American} require a single exercise date expressed by one
  single \lstinline!ExerciseDate! child element.  \emph{Bermudan}
  style options must have two or more \lstinline!ExerciseDate! child
  elements.

\end{itemize}



\subsubsection{Leg Data and Notionals}
\label{ss:leg_data}

The \lstinline!LegData! trade component node is used within the
\lstinline!CapFloorData!,  \lstinline!SwapData! and
\lstinline!SwaptionData! trade data containers. It contains a
\lstinline!ScheduleData! trade component sub-node, and depending on
the value of the \lstinline!LegType! element, one out of the following
sub-nodes:  \lstinline!FixedLegData!, \lstinline!FloatingLegData!. The
\lstinline!LegData! node also includes a \lstinline!Notionals!
sub-node  with \lstinline!Notional! child elements described below. An
example structure of a \lstinline!LegData! node of \lstinline!LegType!
floating is shown in Listing \ref{lst:leg_data}.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
            <LegData>
                <Payer>false</Payer>
                <LegType>Floating</LegType>
                <Currency>EUR</Currency>
                <PaymentConvention>Following</PaymentConvention>
                <DayCounter>30/360</DayCounter>
                <Notionals>
                    <Notional>1000000</Notional>
                </Notionals>
                <ScheduleData>
                    ...
                </ScheduleData>
                <FloatingLegData>
                    ...
                </FloatingLegData>
            </LegData>
\end{minted}
\caption{Leg data}
\label{lst:leg_data}
\end{listing}

The meanings and allowable values of the elements in the \lstinline!LegData! node follow below.

\begin{itemize}
\item LegType:  Determines which of the available sub-nodes must be
  used. 

Allowable values:  \emph{Fixed, Floating, Cashflow, YY, CPI}

\item Payer:  The flows of the leg are paid to the counterparty if
  \emph{true}, and received if \emph{false}.  

Allowable values:  \emph{true, false} 

\item Currency: The currency of the leg. 

Allowable values:  See \lstinline!Currency! in Table \ref{tab:allow_stand_data}.

\item DayCounter: The day count convention of the leg coupons. 

Allowable values: See \lstinline!DayCount Convention! in Table \ref{tab:daycount}.

\item PaymentConvention: The payment convention of the leg coupons. 

Allowable values: See \lstinline!Roll Convention! in Table \ref{tab:allow_stand_data}.

\item Notionals: This node contains child elements of type
  \lstinline!Notional!. If the notional is fixed over the life of the
  leg only one notional value should be entered. If the notional is
  amortising or accreting, this is represented by entering multiple
  notional values, each represented by a \lstinline!Notional! child
  element. The first notional value corresponds to the first coupon,
  the second notional value corresponds to the second coupon, etc. If
  the number of coupons exceeds the number of notional values, the
  notional will be kept flat at the value of last entered notional for
  the remaining coupons.  The number of entered notional values cannot
  exceed the number of coupons.

Allowable values: Each child element can take any positive real number.

\vspace{1em}

An example of a \lstinline!Notionals! element for an amortising leg with four coupons is shown in Listing \ref{lst:notionals}.
\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
                <Notionals>
                    <Notional>65000000</Notional>
                    <Notional>65000000</Notional>
                    <Notional>55000000</Notional>
                    <Notional>45000000</Notional>
                </Notionals>
\end{minted}
\caption{Notional list}
\label{lst:notionals}
\end{listing}

Another allowable specification of the notional schedule is shown in Listing \ref{lst:notionals_dates}. 
\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
                <Notionals>
                    <Notional>65000000</Notional>
                    <Notional startDate='2016-01-02'>65000000</Notional>
                    <Notional startDate='2017-01-02'>55000000</Notional>
                    <Notional startDate='2021-01-02'>45000000</Notional>
                </Notionals>
\end{minted}
\caption{Notional list with dates}
\label{lst:notionals_dates}
\end{listing}
The first notional must not have a start date, it will be associated
with the schedule's start, The subsequent notionals can have a start
date specified from which date onwards the new notional is applied. This allows
specifying notionals only for dates where the notional changes. 

\vspace{1em} 

In case of exchange of currencies an initial exchange, a final exchange
and an amortising exchange can be specified using an \lstinline!Exchanges! child element with \break
\lstinline!NotionalInitialExchange!, \lstinline!NotionalFinalExchange! and \break
\lstinline!NotionalAmortizingExchange! as subelements, see listing
\ref{lst:notional_exchange}.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
                <Notionals>
                    <Notional>65000000</Notional>
                    <Exchanges>
                      <NotionalInitialExchange>true</NotionalInitialExchange>
                      <NotionalFinalExchange>true</NotionalFinalExchange>
                      <NotionalAmortizingExchange>true</NotionalAmortizingExchange>
                    </Exchanges>
                </Notionals>
\end{minted}
\caption{Notional list with exchange}
\label{lst:notional_exchange}
\end{listing}

FX Resets can be specified using an \lstinline!FXReset! child element with subelements \break
\lstinline!ForeignCurrency! (currencyCode), \lstinline!ForeignAmount! (double), \lstinline!FXIndex! and \break
\lstinline!FixingDays! (integer) subelements, see listing
\ref{lst:notional_fxreset} for an example

 \begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
                <Currency>USD</Currency>
                <Notionals>
                    <Notional>65000000</Notional> <!-- in USD -->
                    <FXReset>
                      <ForeignCurrency> EUR </ForeignCurrency>
                      <ForeignAmount> 60000000 </ForeignAmount>
                      <FXIndex> FX-SOURCE-USD-EUR </FXIndex>
                      <FixingDays> 2 </FixingDays>
                    </FXReset>
                </Notionals>
\end{minted}
\caption{Notional list with exchange}
\label{lst:notional_fxreset}
\end{listing}


\item ScheduleData: This is a trade component sub-node outlined in section \ref{ss:schedule_data} Schedule Data and
Dates.
\item FixedLegData: This trade component sub-node is required if \lstinline!LegType! is set to \emph{fixed} It is
outlined in section \ref{ss:fixedleg_data} Fixed Leg Data and Rates.
\item FloatingLegData: This trade component sub-node is required if \lstinline!LegType! is set to \emph{floating} It is
outlined in section \ref{ss:floatingleg_data} Floating Leg Data and Spreads.
\item CPILegData: This trade component sub-node is required if \lstinline!LegType! is set to \emph{CPI}. It is
  outlined in section \ref{ss:cpilegdata} CPI Leg Data.
\item YYLegData: This trade component sub-node is required if \lstinline!LegType! is set to \emph{YY}. It is
  outlined in section \ref{ss:yylegdata} YY Leg Data.
\end{itemize}

\subsubsection{Schedule Data and Dates}\label{ss:schedule_data}

The \lstinline!ScheduleData! trade component node is used within the \lstinline!LegData! trade component. When
\lstinline!IsRulesBased! is set to \emph{false}, the \lstinline!ScheduleData! node includes a \lstinline!Dates! sub-node
where the schedule is determined directly by \lstinline!Date! child elements. The schedule can also be generated from a
set of rules based on the entries of the StartDate, EndDate, Tenor, Calendar, Convention, TermConvention, and Rule
elements.  Example structures of \lstinline!ScheduleData! nodes based on rules respectively dates are shown in Listing
\ref{lst:schedule_data_true} and Listing \ref{lst:schedule_data_false}, respectively.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
              <ScheduleData>
                    <Rules>
                        <StartDate>2013-02-01</StartDate>
                        <EndDate>2030-02-01</EndDate>
                        <Tenor>1Y</Tenor>
                        <Calendar>UK</Calendar>
                        <Convention>MF</Convention>
                        <TermConvention>MF</TermConvention>
                        <Rule>Forward</Rule>
                    </Rules>
              </ScheduleData>
\end{minted}
\caption{Schedule data, rules based}
\label{lst:schedule_data_true}
\end{listing}

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
               <ScheduleData>
                    <Dates>
                        <Date>2012-01-06</Date>
                        <Date>2012-04-10</Date>
                        <Date>2012-07-06</Date>
                        <Date>2012-10-08</Date>
                        <Date>2013-01-07</Date>
                        <Date>2013-04-08</Date>
                    </Dates>
                </ScheduleData>
\end{minted}
\caption{Schedule data, date based}
\label{lst:schedule_data_false}
\end{listing}

The ScheduleData section can contain any number and combination of
{\tt <Dates>} and {\tt <Rules>} sections. The resulting schedule will
then be an ordered concatenation of individual schedules.
 
\medskip
The meanings and allowable values of the elements in the \lstinline!ScheduleData! node follow below.

\begin{itemize}
  % \item IsRulesBased: Determines whether the schedule is set by specifying dates directly, or by specifying rules that
  %   generate the schedule. If \emph{true}, the following entries are required: StartDate, EndDate, Tenor, Calendar,
  %   Convention, TermConvention, and Rule.  If false the Dates sub-node is required. \\ Allowable values: \emph{true,
  %   false}
\item StartDate:  The schedule start date.  

Allowable values:  See \lstinline!Date! in Table \ref{tab:allow_stand_data}.

\item EndDate: The schedule end date.  

Allowable values:  See \lstinline!Date! in Table \ref{tab:allow_stand_data}.

\item Tenor: The tenor used to generate schedule dates. 

Allowable values: A string where the last character must be D or W or
M or Y.  The characters before that must be a positive integer. \\D
$=$ Day, W $=$ Week, M $=$ Month, Y $=$ Year

\item Calendar: The calendar used to generate schedule  dates. 

Allowable values: See Table \ref{tab:calendar} Calendar.

\item Convention: Determines the adjustment of the schedule dates with
  regards to the selected calendar. 

Allowable values: See \lstinline!Roll Convention! in Table
\ref{tab:allow_stand_data}.

\item TermConvention: Determines the adjustment of the final schedule
  date with regards to the selected calendar. 

Allowable values: See \lstinline!Roll Convention! in Table \ref{tab:allow_stand_data}.

\item Rules: Rules for the generation of the schedule using given
  start and end dates, tenor, calendar and business day conventions. 

Allowable values and descriptions: See Table \ref{tab:rule} Rule.

\item Dates: This is a sub-node and contains child elements of type
  \lstinline!Date!. In this case the schedule dates are determined
  directly by the \lstinline!Date! child elements.  At least two
  \lstinline!Date! child elements must be provided.     

  Allowable values: Each \lstinline!Date!  child element can take the allowable values listed in \lstinline!Date! in
  Table \ref{tab:allow_stand_data}.

\end{itemize}



\begin{table}[H]
\centering
\begin{tabular}{|l|p{6cm}|}
\hline
\multicolumn{2}{|l|}{\lstinline!Rule!}                    \\ \hline
\textbf{Allowable Values}                   & \textbf{Effect}                       \\ \hline
\emph{Backward}   &   Backward from termination date to effective date.   \\ \hline
\emph{Forward}   &   Forward from effective date to termination date.  \\ \hline
\emph{Zero}   &   No intermediate dates between effective date and termination date.  \\ \hline
\emph{ThirdWednesday}   &   All dates but effective date and
                          termination date are taken to be on the
                          third Wednesday of their month (with forward calculation.) \\ \hline
\emph{Twentieth}   &   All dates but the effective date are taken to be the twentieth of their month (used for CDS schedules in emerging markets.)  The termination date is also modified. \\ \hline
\emph{TwentiethIMM}   &   All dates but the effective date are  taken to be the twentieth of an IMM month (used for CDS schedules.)  The termination date is also modified. \\ \hline
\emph{OldCDS}   &   Same as TwentiethIMM with unrestricted date ends and log/short stub coupon period (old CDS convention).\\ \hline
CDS   &   Credit derivatives standard rule since 'Big Bang' changes in 2009.\\ \hline
\end{tabular}
  \caption{Allowable Values for Rule}
  \label{tab:rule}
\end{table}

\subsubsection{Fixed Leg Data and Rates}
\label{ss:fixedleg_data}

The \lstinline!FixedLegData! trade component node is used within the \lstinline!LegData! trade component when the
\lstinline!LegType! element is set to \emph{Fixed}. The \lstinline!FixedLegData! node only includes the
\lstinline!Rates! sub-node which contains the rates of the fixed leg as child elements of type \lstinline!Rate!.

An example of a \lstinline!FixedLegData! node for a fixed leg with constant notional is shown in Listing \ref{lst:fixedleg_data}.
\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
              <FixedLegData>
                    <Rates>
                        <Rate>0.05</Rate>
                    </Rates>
              </FixedLegData>
\end{minted}
\caption{Fixed leg data}
\label{lst:fixedleg_data}
\end{listing}

The meanings and allowable values of the elements in the \lstinline!FixedLegData! node follow below.

\begin{itemize}

\item Rates: This node contains child elements of type
  \lstinline!Rate!. If the rate is constant over the life of the fixed
  leg only one rate value should be entered. If two or more coupons
  have different rates, multiple rate values are required, each
  represented by a \lstinline!Rate! child element. The first rate
  value corresponds to the first coupon, the second rate value
  corresponds to the second coupon, etc. If the number of coupons
  exceeds the number of rate values, the rate will be kept flat at the
  value of last entered rate for the remaining coupons.  The number of
  entered rate values cannot exceed the number of coupons. 

  Allowable values: Each child element can take any  real number. The rate is
  expressed in decimal form, e.g. 0.05 is a rate of 5\%.

As in the case of notionals, the rate schedule can be specified with
dates as shown in Listing \ref{lst:fixedleg_data_dates}.
\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
              <FixedLegData>
                    <Rates>
                        <Rate>0.05</Rate>
                        <Rate startDate='2016-02-04'>0.05</Rate>
                        <Rate startDate='2019-02-05'>0.05</Rate>
                    </Rates>
              </FixedLegData>
\end{minted}
\caption{Fixed leg data with 'dated' rates}
\label{lst:fixedleg_data_dates}
\end{listing}

\end{itemize}

\subsubsection{Floating Leg Data, Spreads, Gearings, Caps and Floors}
\label{ss:floatingleg_data}

The \lstinline!FloatingLegData! trade component node is used within the \lstinline!LegData! trade component when the
\lstinline!LegType! element is set to \emph{Floating}. It is also used directly within the \lstinline!CapFloor! trade
data container.  The \lstinline!FloatingLegData! node includes elements specific to a floating leg as well as the
\lstinline!Spreads! sub-node which contains the spreads of the floating leg as child elements of type
\lstinline!Spread!.

An example of a \lstinline!FloatingLegData! node is shown in Listing \ref{lst:floatingleg_data}.
\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
                <FloatingLegData>
                    <Index>USD-LIBOR-3M</Index>
                    <IsInArrears>false</IsInArrears>
                    <FixingDays>2</FixingDays>
                    <Spreads>
                        <Spread>0.005</Spread>
                    </Spreads>
                    <Gearings>
                        <Gearing>2.0</Gearing>
                    </Gearings>
                    <Caps>
                        <Cap>0.05</Cap>
                    </Caps>
                    <Floors>
                        <Floor>0.01</Floor>
                    </Floors>
                </FloatingLegData>
                <NakedOption>N</NakedOption>
\end{minted}
\caption{Floating leg data}
\label{lst:floatingleg_data}
\end{listing}

The meanings and allowable values of the elements in the \lstinline!FloatingLegData! node follow below.

\begin{itemize}
\item Index:  The combination of currency, index and term that
  identifies the relevant fixings and yield curve of the floating leg.  

  Allowable values: An alphanumeric string on the form CCY-INDEX-TERM, matching available Ibor indices in the {\tt
    simulation.xml} file. CCY, INDEX and TERM must be separated by dashes (-). TERM must be an integer followed by D, W,
  M or Y. See Table \ref{tab:indices}.

\item IsInArrears:  \emph{true} indicates that  fixing is in arrears,
  i.e. the fixing gap is calculated in relation to the current period
  end date.\\ \emph{false} indicates that  fixing is in advance,
  i.e. the fixing gap is calculated in relation to the previous period
  end date.  

Allowable values:  \emph{true, false}

\item FixingDays: This is the fixing gap, i.e. the number of days
  before the period end date an index fixing is taken.   

Allowable values:  Positive integers.  

\item Spreads: This node contains child elements of type
  \lstinline!Spread!. If the spread is constant over the life of the
  floating leg only one spread value should be entered. If two or more
  coupons have different spreads, multiple spread values are required,
  each represented by a \lstinline!Spread! child element. The first
  spread value corresponds to the first coupon, the second spread
  value corresponds to the second coupon, etc. If the number of
  coupons exceeds the number of spread values, the spread will be kept
  flat at the value of last entered spread for the remaining coupons.
  The number of entered spread values cannot exceed the number of
  coupons. 

  Allowable values: Each child element can take any real number. The spread is expressed in decimal form, e.g. 0.005 is
  a spread of 0.5\% or 50 bp.

For the {\tt <Spreads>} section, the same applies as for notionals and
rates - a list of changing spreads can be specified without or with individual starte dates as shown
in Listing \ref{lst:spreads_dates}.
\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
                    <Spreads>
                        <Spread>0.005</Spread>
                        <Spread startDate='2017-03-05'>0.007</Spread>
                        <Spread startDate='2019-03-05'>0.009</Spread>
                    </Spreads>
\end{minted}
\caption{'Dated' spreads}
\label{lst:spreads_dates}
\end{listing}

\item Gearings: This node contains child elements of type \lstinline!Gearing! indicating that the coupon rate is
  multiplied by the given factors. The mode of specification is analogous to spreads, see above.

\item Caps: This node contains child elements of type \lstinline!Cap! indicating that the coupon rate is capped at the
  given rate (after applying gearing and spread, if any). The mode of specification is analogous to spreads, see above.

\item Floors: This node contains child elements of type \lstinline!Floor! indicating that the coupon rate is floored at
  the given rate(after applying gearing and spread, if any). The mode of specification is analogous to spreads, see
  above.

\item NakedOption: Optional node (defaults to N), if Y the leg represents only the embedded floor, cap or collar. 
By convention these embedded options are considered long if the leg is a receiver leg, otherwise short. 

\end{itemize}

\subsubsection{Leg Data with Amortisation Structures}
\label{ss:amortisationdata}

Amortisation structures can (optionally) be added to a leg as
indicated in the following listing \ref{lst:amortisations}, within a
block of information enclosed by {\tt <Amortizations>} and {\tt
  </Amortizations>} tags.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
      <LegData>
        <LegType> ... </LegType>
        <Payer> ... </Payer>
        <Currency> ... </Currency>
        <Notionals>
          <Notional>10000000</Notional>
        </Notionals>
        <Amortizations>
          <AmortizationData>
            <Type>FixedAmount</Type>
            <Value>1000000</Value>
            <StartDate>20170203</StartDate>
            <Frequency>1Y</Frequency>
            <Underflow>false</Underflow>
          </AmortizationData>
          <AmortizationData>
            ...
          </AmortizationData>
        </Amortizations>
        ...
      </LegData>
\end{minted}
\caption{Amortisation data}
\label{lst:amortisations}
\end{listing}

The user can specify a sequence of {\tt AmortizationData} items in
order to switch from one kind of amortisation to another etc.  
Within each {\tt AmortisationData} block the meaning of elements is

\begin{itemize}
\item Type: Amortisation type with allowable values {\em FixedAmount,
  RelativeToInitialNotional, RelativeToPreviousNotional, Annuity.}
\item Value: Interpreted depending on {\tt Type}, see below
\item StartDate: Amortisation starts on first schedule date on or
  beyond StartDate
\item Frequency, entered as a period: Frequency of amortisations
\item Underflow:  Allow amortisation below zero notional if {\tt true},
  otherwise amortisation stops at zero notional 
\end{itemize}

The amortisation data block's {\tt Value} element  is interpreted
depending on the chosen {\tt Type}:
\begin{itemize}
\item FixedAmount: The value is interpreted as a notional amount to be
  subtracted from the current notional on each amortisation date
\item RelativeToInitialNotional: The value is interpreted as a
  fraction of the {\bf initial} notional to be subtraced from the current
  notional on each amortisation date
\item RelativeToPreviousNotional: The value is interpreted as a
  fraction of the {\bf previous} notional to be subtraced from the current
  notional on each amortisation date
\item Annuity: The value is interpreted as annuity amount (redemption
  plus coupon)
\end{itemize}

Annuity type amortisation is supported for fixed rate legs as well as
floating (ibor) legs. 

Note:
\begin{itemize}
\item Floating annuities require at least one previous vanilla coupon
  in order to work out the first amortisation amount. 
\item Floating legs with annuity amortisation currently do not allow
  switching the amortisation type, i.e. only a  single block of {\tt
    AmortizationData}.
\end{itemize}

\subsubsection{CMS Leg Data}
\label{ss:cmslegdata}

Listing \ref{lst:cmslegdata} shows an example for a leg of type CMS. 

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
      <LegData>
        <LegType>CMS</LegType>
        <Payer>false</Payer>
        <Currency>GBP</Currency>
        <Notionals>
          <Notional>10000000</Notional>
        </Notionals>
        <DayCounter>ACT/ACT</DayCounter>
        <PaymentConvention>Following</PaymentConvention>
        <ScheduleData>
          ...
        </ScheduleData>
        <CMSLegData>
          <Index>EUR-CMS-10Y</Index>
          <Spreads>
            <Spread>0.0010</Spread>
          </Spreads>
          <Gearings>
            <Gearing>2.0</Gearing>
          </Gearings>
          <Caps>
            <Cap>0.05</Cap>
          </Caps>
          <Floors>
            <Floor>0.01</Floor>
          </Floors>
        </CMSLegData>
        <NakedOption>N</NakedOption>
      </LegData>
\end{minted}
\caption{CMS leg data}
\label{lst:cmslegdata}
\end{listing}
 
The CMSLegData block contains the following elements:

\begin{itemize}
\item Index: The underlying CMS index
\item Spreads: The spreads applied to index fixings. As usual, this can be a single value, a vector of values or a dated vector of
  values.
\item IsInArrears:  \emph{true} indicates that  fixing is in arrears,
  i.e. the fixing gap is calculated in relation to the current period
  end date.\\ \emph{false} indicates that  fixing is in advance,
  i.e. the fixing gap is calculated in relation to the previous period
  end date.  
\item FixingDays: This is the fixing gap, i.e. the number of days
  before the period end date an index fixing is taken.   
\item Gearings: This node contains child elements of type \lstinline!Gearing! indicating that the coupon rate is
  multiplied by the given factors. The mode of specification is analogous to spreads, see above.
\item Caps: This node contains child elements of type \lstinline!Cap! indicating that the coupon rate is capped at the
  given rate (after applying gearing and spread, if any). The mode of specification is analogous to spreads, see above.
\item Floors: This node contains child elements of type \lstinline!Floor! indicating that the coupon rate is floored at
  the given rate(after applying gearing and spread, if any). The mode of specification is analogous to spreads, see
  above.
\item NakedOption: Optional node (defaults to N), if Y the leg represents only the embedded floor, cap or collar. 
By convention these embedded options are considered long if the leg is a receiver leg, otherwise short. 
\end{itemize}

\subsubsection{CPI Leg Data}
\label{ss:cpilegdata}

Listing \ref{lst:cpilegdata} shows an example for a leg of type CPI. The CPILegData block contains the following
elements:

\begin{itemize}
\item Index: The underlying zero inflation index
\item Rates: The fixed rate(s) of the leg. As usual, this can be a single value, a vector of values or a dated vector of
  values.
\item BaseCPI: The base CPI used to determine the lifting factor for the fixed coupons
\item ObservationLag: The observation lag to be applied.
\item Interpolated: A flag indicating whether interpolation should be applied to inflation fixings.
\end{itemize}

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
      <LegData>
        <LegType>CPI</LegType>
        <Payer>false</Payer>
        <Currency>GBP</Currency>
        <Notionals>
          <Notional>10000000</Notional>
        </Notionals>
        <DayCounter>ACT/ACT</DayCounter>
        <PaymentConvention>Following</PaymentConvention>
        <ScheduleData>
          <Rules>
            <StartDate>2016-07-18</StartDate>
            <EndDate>2021-07-18</EndDate>
            <Tenor>1Y</Tenor>
            <Calendar>UK</Calendar>
            <Convention>ModifiedFollowing</Convention>
            <TermConvention>ModifiedFollowing</TermConvention>
            <Rule>Forward</Rule>
            <EndOfMonth/>
            <FirstDate/>
            <LastDate/>
          </Rules>
        </ScheduleData>
        <CPILegData>
          <Index>UKRPI</Index>
          <Rates>
            <Rate>0.02</Rate>
          </Rates>
          <BaseCPI>210</BaseCPI>
          <ObservationLag>2M</ObservationLag>
          <Interpolated>false</Interpolated>
        </CPILegData>
      </LegData>
\end{minted}
\caption{CPI leg data}
\label{lst:cpilegdata}
\end{listing}

\subsubsection{YY Leg Data}
\label{ss:yylegdata}

Listing \ref{lst:yylegdata} shows an example for a leg of type YY. The YYLegData block contains the following
elements:

\begin{itemize}
\item Index: The underlying zero inflation index
\item FixingDays: The number of fixing days
\item ObservationLag: The observation lag to be applied.
\item Interpolated: A flag indicating whether interpolation should be applied to inflation fixings.
\end{itemize}

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
      <LegData>
        <LegType>YY</LegType>
        <Payer>false</Payer>
        <Currency>EUR</Currency>
        <Notionals>
          <Notional>10000000</Notional>
        </Notionals>
        <DayCounter>ACT/ACT</DayCounter>
        <PaymentConvention>Following</PaymentConvention>
        <ScheduleData>
          <Rules>
            <StartDate>2016-07-18</StartDate>
            <EndDate>2021-07-18</EndDate>
            <Tenor>1Y</Tenor>
            <Calendar>UK</Calendar>
            <Convention>ModifiedFollowing</Convention>
            <TermConvention>ModifiedFollowing</TermConvention>
            <Rule>Forward</Rule>
            <EndOfMonth/>
            <FirstDate/>
            <LastDate/>
          </Rules>
        </ScheduleData>
        <YYLegData>
          <Index>EUHICPXT</Index>
          <FixingDays>2</FixingDays>
          <ObservationLag>2M</ObservationLag>
          <Interpolated>true</Interpolated>
        </YYLegData>
      </LegData>
\end{minted}
\caption{YY leg data}
\label{lst:yylegdata}
\end{listing}


%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
\subsection{Allowable Values for Standard Trade Data}
\label{sec:allowable_values}
%- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

\begin{table}[H]
\centering
  \begin{tabu} to 0.9\linewidth {| X[-1.5,l,m] | X[-5,l,m] |}
    \hline
    \bfseries{Trade Data} & \bfseries{Allowable Values} \\
    \hline
    \lstinline!Date! & \begin{tabular}[l]{@{}l@{}} The following date formats are supported: \\  \emph{yyyymmdd} \\ \emph{yyyy-mm-dd} \\ \emph{yyyy/mm/dd} \\ \emph{yyyy.mm.dd} \\ \emph{dd-mm-yy} \\  \emph{dd/mm/yy} \\  \emph{dd.mm.yy} \\  \emph{dd-mm-yyyy} \\  \emph{dd/mm/yyyy} \\  \emph{dd.mm.yyyy} \\ and \\ Dates as  serial numbers, comparable to Microsoft Excel \\dates, with a minimum of 367 for Jan 1, 1901,\\ and a maximum of 109574 for Dec 31, 2199.  \end{tabular}  \\ \hline
    \lstinline!Currency! & \emph{ATS, AUD, BEF, BRL, CAD, CHF, CNY,
      CZK, DEM, DKK, EUR, ESP, FIM, FRF, GBP, GRD, HKD, HUF, IEP, ITL,
      INR, ISK, JPY, KRW, LUF, NLG, NOK, NZD, PLN, PTE, RON, SEK, SGD,
      THB, TRY, TWD, USD, ZAR, ARS, CLP, COP, IDR, ILS, KWD, PEN, MXN,
    SAR, RUB, TND, MYR, UAH, KZT, QAR, MXV, CLF, EGP, BHD, OMR, VND,
    AED, PHP, NGN, MAD},  Note: Currency codes must also match available currencies in the {\tt simulation.xml} file.  \\ \hline
    %\lstinline!DayCount!  \lstinline!Convention! & \begin{tabular}[l]{@{}l@{}}\indent Actual 360 can be expressed by:\\ \emph{A360, Actual/360, ACT/360}\\ \indent Actual 365 Fixed can be expressed by: \\ \emph{A365, A365F, Actual/365, Actual/365 (fixed)} \\ \indent Thirty 360 (US) can be expressed by: \\ \emph{T360, 30/360, 30/360 (Bond Basis), ACT/nACT} \\ \indent Thirty 360 (European) can be expressed by: \\ \emph{30E/360, 30E/360 (Eurobond Basis)}\\ \indent Thirty 360 (Italian) is expressed by: \\ \emph{30/360 (Italian)}  \\ \indent Actual Actual (ISDA) can be expressed by: \\ \emph{ActActISDA, ActualActual (ISDA), ACT/ACT, ACT} \\ \indent Actual Actual (ISMA) can be expressed by: \\ \emph{ActActISMA, ActualActual (ISMA)} \\ \indent Actual Actual (AFB) can be expressed by:\\ \emph{ActActAFB, Actual/Actual (AFB)} \end{tabular}  \\ \hline
    \lstinline!Roll Convention! & \begin{tabular}[l]{@{}l@{}} 
\emph{F,  Following, FOLLOWING}\\ 
\emph{MF, ModifiedFollowing, Modified Following, MODIFIEDF}\\ 
\emph{P, Preceding, PRECEDING}\\ 
\emph{MP, ModifiedPreceding, Modified Preceding, MODIFIEDP}\\ 
\emph{U, Unadjusted, INDIFF }\end{tabular}  \\ \hline
  \end{tabu}
  \caption{Allowable values for standard trade data.}
  \label{tab:allow_stand_data}
\end{table}

\begin{table}[H]
  \centering
  \begin{tabu} to 0.9\linewidth {| X[-1.5,l,m] | X[-5,l,m] |}
    \hline
%    \multicolumn{2}{|l|} {\lstinline{Calendar} } \\ \hline
    \multicolumn{2}{|l|} {\tt Calendar}  \\ \hline
    \bfseries{Allowable Values} & \bfseries{Resulting Calendar} \\
    \hline
    \emph{TARGET, TGT, EUR} & Target Calendar  \\ \hline
    \emph{CA,TRB, CAD} & Canada Calendar \\ \hline
    \emph{TKB, JP, JPY} & Japan Calendar \\ \hline
    \emph{ZUB, CHF} & Switzerland Calendar \\ \hline
    \emph{GB, LNB, UK} & UK Calendar \\ \hline
    \emph{US, NYB, USD} & US Calendar \\ \hline
    \emph{US-SET} & US Settlement Calendar \\ \hline
    \emph{US-GOV} & US Government Bond Calendar \\ \hline    
    \emph{US-NYSE} & US NYSE Calendar \\ \hline  
    \emph{US-NERC} & US NERC Calendar \\ \hline  
    \emph{AU, AUD} & Australia Calendar \\ \hline
    \emph{SA, ZAR} & South Africa Calendar \\ \hline
    \emph{SS, SEK} & Sweden Calendar \\ \hline
    \emph{ARS} & Argentina Calendar \\ \hline
    \emph{BRL} & Brazil Calendar \\ \hline
    \emph{CNY} & China Calendar \\ \hline
    \emph{CZK} & Czech Republic Calendar \\ \hline
    \emph{DEN, DKK} & Denmark Calendar \\ \hline
    \emph{FIN} & Finland Calendar \\ \hline
    \emph{HKD} & HongKong Calendar \\ \hline
    \emph{ISK} & Iceland Calendar \\ \hline
    \emph{INR} & India Calendar \\ \hline
    \emph{IDR} & Indonesia Calendar \\ \hline
    \emph{MXN} & Mexico Calendar \\ \hline
    \emph{NZD} & New Zealand Calendar\\ \hline
    \emph{NOK} & Norway Calendar \\ \hline
    \emph{PLN} & Poland Calendar \\ \hline
    \emph{RUB} & Russia Calendar \\ \hline
    \emph{SAR} & Saudi Arabia \\ \hline
    \emph{SGD} & Singapore Calendar \\ \hline
    \emph{KRW} & South Korea Calendar \\ \hline
    \emph{TWD} & Taiwan Calendar \\ \hline
    \emph{TRY} & Turkey Calendar \\ \hline
    \emph{UAH} & Ukraine Calendar \\ \hline
    \emph{WeekendsOnly} & Weekends Only Calendar \\ \hline
    % \emph{US+TARGET, NYB\_TGT, TGT\_NYB} & US and Target Calendar \\ \hline  
    % \emph{NYB\_LNB, LNB\_NYB} & US and UK Calendar \\ \hline    
    % \emph{LNB\_ZUB, ZUB\_LNB} & Switzerland and UK Calendar \\ \hline   
    % \emph{TGT\_ZUB, ZUB\_TGT} & Switzerland and Target Calendar \\ \hline
    % \emph{NYB\_SYB} & US and Australia Calendar \\ \hline 
    % \emph{TGT\_BDP, BDP\_TGT} & Hungary and Target Calendar \\ \hline         
    % \emph{LNB\_NYB\_TGT} & UK, US and Target Calendar \\ \hline
    % \emph{TKB\_TGT\_LNB} & Japan, Target and UK Calendar \\ \hline         
    % \emph{LNB\_NYB\_ZUB} & UK, US and Switzerland Calendar \\ \hline
    % \emph{LNB\_NYB\_TRB} & UK, US and Canada Calendar \\ \hline 
    % \emph{LNB\_NYB\_TKB} & UK, US and Japan Calendar \\ \hline   
    % \emph{NullCalendar} & Null Calendar, i.e. all days are business days \\ \hline                 
  \end{tabu}
  \caption{Allowable Values for Calendar. Combinations of up to four
    calendars can be provided using comma separated calendar names.}
  \label{tab:calendar}
\end{table}

\begin{table}[H]
\centering
  \begin{tabu} to 0.9\linewidth {| X[-1.5,l,m] | X[-5,l,m] |}
    \hline
    %\multicolumn{2}{|l|}{\lstinline{DayCount Convention} }                             \\ \hline
    \multicolumn{2}{|l|}{\tt DayCount Convention}                          \\ \hline
    \bfseries{Allowable Values} & \bfseries{Resulting DayCount Convention} \\
    \hline
    \emph{A360, Actual/360, ACT/360}& Actual 360  \\ \hline
    \emph{A365, A365F, Actual/365, Actual/365 (fixed)} & Actual 365 Fixed \\ \hline
    \emph{T360, 30/360, 30/360 (Bond Basis), ACT/nACT} & Thirty 360 (US) \\ \hline
    \emph{30E/360, 30E/360 (Eurobond Basis)} & Thirty 360 (European) \\ \hline
    \emph{30/360 (Italian)} & Thirty 360 (Italian) \\ \hline
    \emph{ActActISDA, ActualActual (ISDA), ACT/ACT, ACT} & Actual Actual (ISDA) \\ \hline
    \emph{ActActISMA, ActualActual (ISMA)} & Actual Actual (ISMA) \\ \hline
    \emph{ActActAFB, Actual/Actual (AFB)} & Actual Actual (AFB) \\ \hline           
  \end{tabu}
  \caption{Allowable Values for DayCount Convention}
  \label{tab:daycount}
\end{table}

\begin{table}[H]
\centering
\begin{tabular}{|l|l|}
\hline
%\multicolumn{2}{|l|}{\lstinline!Index!}   \\ \hline
\multicolumn{2}{|l|}{\tt Index}   \\ \hline
\multicolumn{2}{|l|}{On form CCY-INDEX-TENOR, and matching available  }   \\ 
\multicolumn{2}{|l|}{ indices in the {\tt simulation.xml} file. }   \\ \hline
\textbf{Index Component} & \textbf{Allowable Values}                                                                                                                                                                                                                                                           \\ \hline
CCY-INDEX                &
                           \textit{\begin{tabular}[c]{@{}l@{}}
EUR-EONIA\\ EUR-EURIBOR\\ EUR-LIBOR\\ 
USD-FedFunds\\ USD-LIBOR\\ 
GBP-SONIA\\ GBP-LIBOR\\ 
JPY-LIBOR\\ JPY-TIBOR \\
CHF-LIBOR\\ 
AUD-LIBOR\\ AUD-BBSW\\ 
CAD-CDOR\\ CAD-BA\\ 
SEK-STIBOR\\ SEK-LIBOR\\ 
DKK-LIBOR\\ DKK-CIBOR \\
SGD-SIBOR\\ SGD-SOR \\
HKD-HIBOR \\
NOK-NIBOR \\
HUF-BUBOR \\
IDR-IDRFIX \\
INR-MIFOR \\
MXN-TIIE \\
PLN-WIBOR \\
SKK-BRIBOR \\
NZD-BKBM \\
\end{tabular}} \\ \hline
TENOR                    & An integer followed by \emph{D, W, M or Y}                                                                                                                                                                                                                                                 \\ \hline
\end{tabular}
  \caption{Allowable values for Index.}
  \label{tab:indices}
\end{table}
